$pdk.ns("$pdk.plugin.amcn.rewrite"),$pdk.plugin.amcn.rewrite=$pdk.extend(function(){},{priority:null,controller:null,mvpd:null,mobile:null,mobileAdsReady:!1,policyData:{},scope:[],constructor:function(){console.log("%c rewrite ### constructor | ","background-color: #ffcc00; color: #000000;")},initialize:function(loadObj){console.log("%c rewrite ### initialize | ","background-color: #ffcc00; color: #000000;",loadObj),this.priority=loadObj.priority,this.controller=loadObj.controller,this.mvpd=void 0,this.mobile=$pdk.isIOS||$pdk.isAndroid,this.scope.push(loadObj.controller.component.scopes),this.setPolicyValues(loadObj.vars);var me=this;this.setMvpdParam=function(event){console.log("%c rewrite ### setMvpdParam ","background-color: #ffcc00; color: #000000;"),me.mvpd=event.data},this.controller.addEventListener("OnAmcSetMvpd",this.setMvpdParam,this.scope);try{this.controller.registerMetadataUrlPlugIn(this,this.priority),console.log("%c rewrite ### loaded ","background-color: #ffcc00; color: #000000;")}catch(e){console.log("%c rewrite ### WARN > ","background-color: #ffcc00; color: #000000;",e.message)}},rewriteMetadataUrl:function(releaseUrl,isPreview){console.log("%c rewrite ### rewriteMetadataUrl | ","background-color: #ffcc00; color: #000000;",releaseUrl,isPreview),(isPreview||void 0===this.mvpd)&&(console.log("%c rewrite ### rewriteMetadataUrl | UNDEFINED > ","background-color: #ffcc00; color: #000000;"),this.mvpd="NonAuth");var newUrl=[releaseUrl,releaseUrl.indexOf("?")>=0?"&":"?","mvpd","=",this.mvpd].join("");if(this.mobile&&this.mobileAdsReady!==!0){var playerConfig=amcnPlatformPlayers[this.scope].getConfig();playerConfig.settings.video.details.isLivestream?console.log("%c rewrite ### rewriteMetadataUrl > mobile > livestream ","background-color: #ffcc00; color: #000000;"):(console.log("%c rewrite ### rewriteMetadataUrl > mobile > swapping policy ","background-color: #ffcc00; color: #000000;"),newUrl=newUrl.replace("policy="+this.policyData.default_policy_num,"policy="+this.policyData.ssai_policy_num),this.controller.addEventListener("OnMediaLoadStart",this.OnMediaLoadStart,this.scope)),this.mobileAdsReady=!0,this.controller.dispatchEvent("OnAdsReady",{type:"ads",set:!0,players:this.scope},this.scope)}return console.log("%c rewrite ### rewriteMetadataUrl | newUrl > ","background-color: #ffcc00; color: #000000;",newUrl),this.controller.setMetadataUrl(newUrl),!0},setPolicyValues:function(policyData){this.policyData={default_policy_name:policyData.default_policy_name,default_policy_num:policyData.default_policy_num,ssai_policy_name:policyData.ssai_policy_name,ssai_policy_num:policyData.ssai_policy_num},console.log("%c rewrite ### setPolicyValues > ","background-color: #ffcc00; color: #000000;",this.policyData)},OnMediaLoadStart:function(response){console.log("%c rewrite ### OnMediaLoadStart ","background-color: #ffcc00; color: #000000;",response),response.data.baseClip.isAd?(console.log("%c rewrite ### OnMediaLoadStart > ad","background-color: #ffcc00; color: #000000;",response),$pdk.controller.dispatchEvent("OnAdStarted",{},this.scope)):(console.log("%c rewrite ### OnMediaLoadStart > content","background-color: #ffcc00; color: #000000;",response),$pdk.controller.dispatchEvent("OnAdEnded",{},this.scope))},error:function(){console.log("%c rewrite ### error | ","background-color: #ffcc00; color: #000000;"),this.controller.setMetadataUrl(this.releaseUrl)}});var rewritePlugin=new $pdk.plugin.amcn.rewrite;$pdk.controller.plugInLoaded(rewritePlugin);